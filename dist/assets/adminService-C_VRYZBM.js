import{k as a}from"./index-BxTy90uP.js";async function l(){try{const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{data:r}=await a.from("admin_users").select("*").eq("user_id",e.id).maybeSingle();return!!r}catch(e){return console.error("Error in isAdmin:",e),!1}}async function h(){try{const{data:e,error:r}=await a.from("courses").select("*").order("created_at",{ascending:!1});if(r)throw r;return e||[]}catch(e){throw console.error("Error fetching all courses:",e),e}}async function f(e){try{const{data:r,error:t}=await a.from("courses").select("*").eq("id",e).single();if(t)throw t;return r}catch(r){throw console.error("Error fetching course:",r),r}}async function m(e){try{const{data:{user:r}}=await a.auth.getUser();if(!r)throw new Error("Not authenticated");const{data:t}=await a.from("admin_users").select("*").eq("user_id",r.id).maybeSingle();if(!t)throw new Error(`Admin record not found. Please run the SQL fix from ADMIN_FIX.html:
1. Open ADMIN_FIX.html
2. Copy the SQL
3. Run it in Supabase SQL Editor
4. Log out and log back in`);const{data:o,error:s}=await a.from("courses").insert([e]).select();if(s)throw s.message.includes("row-level security")?new Error(`RLS Policy Error: The database policies are not set correctly.

SOLUTION:
1. Open ADMIN_FIX.html (in your project folder)
2. Click "Copy SQL to Clipboard"
3. Go to https://supabase.com/dashboard/project/hhdronajrkxnetwqppkg/sql/new
4. Paste and click "Run"
5. Log out and log back in

This will fix the permissions permanently.`):s;return Array.isArray(o)?o[0]:o}catch(r){throw console.error("Error creating course:",r),r}}async function y(e,r){try{const{data:t,error:o}=await a.from("courses").update(r).eq("id",e).select();if(o)throw o;return Array.isArray(t)?t[0]:t}catch(t){throw console.error("Error updating course:",t),t}}async function w(e){try{const{error:r}=await a.from("courses").delete().eq("id",e);if(r)throw r;return!0}catch(r){throw console.error("Error deleting course:",r),r}}async function g(e={}){try{let r=a.from("orders").select(`
        *,
        profiles!orders_user_id_fkey(full_name, email)
      `).order("created_at",{ascending:!1});e.status&&(r=r.eq("payment_status",e.status)),e.dateFrom&&(r=r.gte("created_at",e.dateFrom)),e.dateTo&&(r=r.lte("created_at",e.dateTo)),e.search&&(r=r.or(`course_title.ilike.%${e.search}%,order_id.ilike.%${e.search}%`));const{data:t,error:o}=await r;if(o)throw o;return t||[]}catch(r){throw console.error("Error fetching orders:",r),r}}async function p(e,r){try{const{data:t,error:o}=await a.from("orders").update({payment_status:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return t}catch(t){throw console.error("Error updating order status:",t),t}}async function _(){try{const{count:e}=await a.from("courses").select("*",{count:"exact",head:!0}),{count:r}=await a.from("orders").select("*",{count:"exact",head:!0}),{count:t,data:o}=await a.from("orders").select("price_cents",{count:"exact"}).eq("payment_status","success"),s=o?.reduce((i,u)=>i+(u.price_cents||0),0)||0,{count:n}=await a.from("enrollments").select("*",{count:"exact",head:!0}).eq("status","active"),{data:c}=await a.from("orders").select(`
        *,
        profiles!orders_user_id_fkey(full_name, email)
      `).order("created_at",{ascending:!1}).limit(10);return{totalCourses:e||0,totalOrders:r||0,successfulPayments:t||0,totalRevenue:s/100,totalEnrollments:n||0,recentOrders:c||[]}}catch(e){throw console.error("Error fetching dashboard stats:",e),e}}async function E(e=6){try{const r=new Date;r.setMonth(r.getMonth()-e);const{data:t,error:o}=await a.from("orders").select("created_at, price_cents, payment_status").eq("payment_status","success").gte("created_at",r.toISOString());if(o)throw o;const s={};return t?.forEach(n=>{const c=new Date(n.created_at).toLocaleString("default",{month:"short",year:"numeric"});s[c]=(s[c]||0)+n.price_cents/100}),Object.entries(s).map(([n,c])=>({month:n,revenue:c}))}catch(r){throw console.error("Error fetching revenue by month:",r),r}}async function S(){try{const{data:e,error:r}=await a.from("enrollments").select("course_title, branch").eq("status","active");if(r)throw r;const t={};return e?.forEach(o=>{const s=o.course_title;t[s]=(t[s]||0)+1}),Object.entries(t).map(([o,s])=>({course:o,count:s})).sort((o,s)=>s.count-o.count).slice(0,10)}catch(e){throw console.error("Error fetching course enrollment stats:",e),e}}export{E as a,S as b,m as c,h as d,w as e,f,_ as g,g as h,l as i,p as j,y as u};
