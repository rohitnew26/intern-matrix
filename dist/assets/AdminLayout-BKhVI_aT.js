import{d as a,j as e}from"./index-D44h95bS.js";import{a as b,u as j,r as o,L as y,O as w}from"./router-CVYtFGGO.js";import{i as v}from"./adminService-BI8HGu6B.js";import{X as N,y as A,G as E,z as S,U as k,D as C,E as L,H as _}from"./ui-C5TzJgQi.js";import"./react-Bq7xPAhO.js";async function u(){try{const{data:{user:r}}=await a.auth.getUser();if(!r||r.email!=="appdostofficial@gmail.com")return!1;const{data:l,error:n}=await a.from("admin_users").select("*").eq("user_id",r.id).maybeSingle();if(n)return console.error("Error checking admin status:",n),!1;if(!l){console.log("Creating admin record...");const{error:i}=await a.from("admin_users").insert({user_id:r.id,email:r.email,role:"super_admin",permissions:{all:!0}});if(i){console.error("Error creating admin record:",i);const{error:t}=await a.from("admin_users").upsert({user_id:r.id,email:r.email,role:"super_admin",permissions:{all:!0}},{onConflict:"user_id"});if(t)return console.error("Error upserting admin record:",t),!1}return console.log("✅ Admin record created successfully"),await new Promise(t=>setTimeout(t,500)),!0}return!0}catch(r){return console.error("Error in ensureAdminSetup:",r),!1}}u().then(r=>{r&&console.log("✅ Admin setup verified")});function P(){const r=b(),l=j(),[n,i]=o.useState(null),[t,h]=o.useState(!0),[d,c]=o.useState(!0);o.useEffect(()=>{f()},[]);async function f(){try{const{data:{user:s}}=await a.auth.getUser();if(!s){r("/login");return}if(await u(),!await v()){alert("Access Denied: You do not have admin privileges"),r("/");return}i(s)}catch(s){console.error("Error checking admin access:",s),r("/")}finally{h(!1)}}async function x(){await a.auth.signOut(),r("/login")}const g=[{name:"Dashboard",href:"/no-admin-control",icon:A},{name:"Courses",href:"/no-admin-control/courses",icon:E},{name:"Orders",href:"/no-admin-control/orders",icon:S},{name:"Enrollments",href:"/no-admin-control/enrollments",icon:k},{name:"Settings",href:"/no-admin-control/settings",icon:C}];return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out ${d?"translate-x-0":"-translate-x-full"} lg:translate-x-0`,children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 bg-gray-800",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Admin Panel"}),e.jsx("button",{onClick:()=>c(!1),className:"lg:hidden text-gray-400 hover:text-white",children:e.jsx(N,{className:"w-6 h-6"})})]}),e.jsx("nav",{className:"mt-6 px-3",children:g.map(s=>{const m=s.icon,p=l.pathname===s.href;return e.jsxs(y,{to:s.href,className:`flex items-center px-4 py-3 mb-2 rounded-lg transition-colors ${p?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"}`,children:[e.jsx(m,{className:"w-5 h-5 mr-3"}),e.jsx("span",{className:"font-medium",children:s.name})]},s.name)})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-800",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold",children:n?.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-3 overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:n?.email}),e.jsx("p",{className:"text-xs text-gray-400",children:"Admin"})]})]}),e.jsxs("button",{onClick:x,className:"flex items-center w-full px-4 py-2 text-sm text-gray-300 hover:bg-gray-800 hover:text-white rounded-lg transition-colors",children:[e.jsx(L,{className:"w-4 h-4 mr-3"}),"Logout"]})]})]}),e.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-40",children:e.jsx("button",{onClick:()=>c(!0),className:"p-2 rounded-lg bg-white shadow-lg text-gray-600 hover:text-gray-900",children:e.jsx(_,{className:"w-6 h-6"})})}),e.jsx("div",{className:"lg:pl-64",children:e.jsx("main",{className:"p-6",children:e.jsx(w,{})})}),d&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>c(!1)})]})}export{P as default};
